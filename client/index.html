<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Onboarding YouTube Project</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="youtube.css" rel="stylesheet">
  <link rel="stylesheet" href="https://bootswatch.com/4/cyborg/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css?family=Share+Tech+Mono" rel="stylesheet">
  <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
</head>
  
  <body>
    <h1>Onboarding YouTube SPA</h1>
    <div class="wrapper">
      <div class="controls">
        <form>
          <p>
            <label for="search">Enter a search term (required): </label>
            <input type="text" id="search" class="search" required>
          </p>
          <p>
            <button class="submit">Submit search</button>
          </p>
        </form>
      </div>
      
      <!-- <form>
       <div class="form-group row">
        <div class="form-group">
         <label for="exampleSelect1">Sort By</label>
          <select class="form-control" id="exampleSelect1">
           <option>Relevance</option>
           <option>Date</option>
           <option>Rating</option>
          </select>
         </div>
        </div>
      </form> -->

      <div id="loading">
      <h3>Loading...</h3>
      <video src="https://cdn.flixel.com/flixel/vg5u60m126u7qydd3e9i.phone.mp4" loop autoplay></video>
      </div>
    
      <section class="row" id="videos">
      </section>

      <div class="results">
        <section>
        </section>
      </div>

    </div>

    <script src="https://apis.google.com/js/client.js" type="text/javascript"></script>
    <script type='text/javascript' src='config.js'></script>

    <script>
      const myKey = config.YOUTUBE_API_KEY;
      // Get references to DOM elements we need to manipulate
      const searchTerm = document.querySelector('.search');
      const searchForm = document.querySelector('form');
      const submitBtn = document.querySelector('.submit');
      const loadingElement = document.querySelector('#loading');
      const videosElement = document.querySelector('#videos');
      const section = document.querySelector('section');

      let videoElementsById = {};
      window.onload = onClientLoad;
      function onClientLoad() {
        gapi.client.load('youtube', 'v3', onYouTubeApiLoad);
      }


      function onYouTubeApiLoad() {
        gapi.client.setApiKey(myKey);
        searchForm.addEventListener('submit', search);
      }

      function search(e) {
        e.preventDefault();
        let request = gapi.client.youtube.search.list({
          part: 'snippet',
          maxResults: 10,
          q: searchTerm.value,
          order: 'relevance'
        });
        console.log(request);
        request.execute(onSearchResponse);
      }

      // This function automatically has the response passed in as a parameter
      function onSearchResponse(response) {
        // Empty the <section> element
        while (section.firstChild) {
            section.removeChild(section.firstChild);
        }
        let results = response.items;
        showVideos(results);
      }

  function showVideos(videos) {
  localStorage.videos = JSON.stringify(videos);
  console.log(videos);
  loadingElement.style.display = 'none';

  videos.forEach((video) => {
    const colDiv = document.createElement('div');
    colDiv.className = 'col-xs-1 col-sm-6 col-md-4 video';
    videoElementsById[video.id] = colDiv;

    const link = document.createElement('a');
    link.setAttribute('target', '_blank');
    link.href = `https://www.youtube.com/watch?v=${video.id.videoId}`;

    const videoElement = document.createElement('div');
    videoElement.className = 'card ma-1';

    const img = document.createElement('img');

    const imageRes = video.snippet.thumbnails.standard || video.snippet.thumbnails.medium || video.snippet.thumbnails.high;
    img.src = imageRes.url;
    img.className = 'card-img-top';
    videoElement.appendChild(img);

    const mediaBody = document.createElement('div');
    mediaBody.className = 'card-body';
    videoElement.appendChild(mediaBody);

    const h5 = document.createElement('h5');
    h5.className = 'card-title';
    h5.textContent = video.snippet.title;

    const dateTime = document.createElement('P');
    dateTime.className = 'card-text';
    dateTime.textContent = video.snippet.publishedAt;
    
    const channelTitle = document.createElement('P');
    channelTitle.className = 'card-text';
    channelTitle.textContent = video.snippet.channelTitle; 

    mediaBody.appendChild(h5);
    mediaBody.appendChild(channelTitle);
    mediaBody.appendChild(dateTime);
    link.appendChild(videoElement);
    colDiv.appendChild(link);
    videosElement.appendChild(colDiv);


    const videoDetailsURL = fetch(`https://www.googleapis.com/youtube/v3/videos?part=statistics&id=${video.id.videoId}&key=` + myKey)
         .then(response => response.json())
         .then(showvideoDetails);   
    
    function showvideoDetails(videoDetails) {
      localStorage.videoDetails = JSON.stringify(videoDetails);
      console.log(videoDetails);
      console.log(videoDetails.items[0].statistics);
      
      const videoMetadata = document.createElement('P');
      videoMetadata.className = 'card-text';
      videoMetadata.textContent = 'VIEW COUNT:' + videoDetails.items[0].statistics.viewCount + ' ' + 'LIKES:' + videoDetails.items[0].statistics.likeCount + ' ' + 'DISLIKES:' + videoDetails.items[0].statistics.dislikeCount + ' ' + 'FAVORITES:' + videoDetails.items[0].statistics.favoriteCount + ' ' + 'COMMENTS:' + videoDetails.items[0].statistics.commentCount;
      
      mediaBody.appendChild(videoMetadata);
    }
  });
}
    </script>


  </body>
</html>
