  <!DOCTYPE html>
  <html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Onboarding YouTube Project</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link href="youtube.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="https://bootswatch.com/4/cyborg/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Share+Tech+Mono" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
  </head>
  <body>
    <div class="list-group">
      <a href="#" class="list-group-item list-group-item-action flex-column align-items-start active">
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">Favorites</h5>
          <small id='test'>Here</small>
        </div>
        <p class="mb-1">Donec id elit non mi porta gravida at eget metus. Maecenas sed diam eget risus varius blandit.</p>
        <small>Donec id elit non mi porta.</small>
      </a>
  </div>
  <h1>Onboarding YouTube SPA</h1>
  <div class="wrapper">
    <div class="controls">
      <form>
        <fieldset class="form-group">
          <legend>Order Search Results by:</legend>
          <div class="form-check">
            <label class="form-check-label">
              <input type="radio" class="form-check-input" name="optionsRadios" id="relevance" value="relevance" >
              Relevance
            </label>
          </div>
          <div class="form-check">
            <label class="form-check-label">
              <input type="radio" class="form-check-input" name="optionsRadios" id="date" value="date">
              Date
            </label>
          </div>
          <div class="form-check">
            <label class="form-check-label">
              <input type="radio" class="form-check-input" name="optionsRadios" id="rating" value="rating" checked>
              Rating
            </label>
          </div>
        </fieldset>
        <p>
          <label for="search">Enter a search term (required): </label>
          <input type="text" id="search" class="search" required>
        </p>
        <p>
          <button class="submit">Submit search</button>
        </p>
      </form>
    </div>

    <div id="loading">
      <h3>Loading...</h3>
      <video src="https://cdn.flixel.com/flixel/7a0iejyutuuc9p8rdss3.phone.mp4" loop autoplay></video>
    </div>

    <section class="row" id="videos">
    </section>

    <div>
      <section>
      </section>
    </div>

  </div>

  <script src="https://apis.google.com/js/client.js" type="text/javascript"></script>
   <script src="https://www.youtube.com/iframe_api" type="text/javascript"></script>
  <script type='text/javascript' src='config.js'></script>

  <script>
    const myKey = config.YOUTUBE_API_KEY;
      // Get references to DOM elements we need to manipulate
      const searchTerm = document.querySelector('.search');
      const searchForm = document.querySelector('form');
      const submitBtn = document.querySelector('.submit');
      const loadingElement = document.querySelector('#loading');
      const videosElement = document.querySelector('#videos');
      const section = document.querySelector('section');
      let favVideos = JSON.parse(localStorage.getItem("favs") || "[]");

      let videoElementsById = {};
      window.onload = onClientLoad;
      function onClientLoad() {
        gapi.client.load('youtube', 'v3', onYouTubeApiLoad);
      }

      function onYouTubeApiLoad() {
        gapi.client.setApiKey(myKey);
        searchForm.addEventListener('submit', search);
      }

      function search(e) {
        e.preventDefault();
        let order= document.querySelector('input[name="optionsRadios"]:checked').value;
        let request = gapi.client.youtube.search.list({
          part: 'snippet',
          maxResults: 10,
          q: searchTerm.value,
          order: order,
          type: 'video',
          videoDuration: 'medium'
        });
        console.log(request);
        request.execute(onSearchResponse);
      }

      // This function automatically has the response passed in as a parameter
      function onSearchResponse(response) {
        // Empty the <section> element
        while (section.firstChild) {
          section.removeChild(section.firstChild);
        }
        let results = response.items;
        showVideos(results);
      }
      function showVideos(videos) {
        localStorage.videos = JSON.stringify(videos);
        console.log(videos);
        loadingElement.style.display = 'none';
let favVideos = JSON.parse(localStorage.getItem("favs") || "[]");
         console.log(favVideos);

        videos.forEach((video) => {
          const idVideo = video.id.videoId;
          const colDiv = document.createElement('div');
          colDiv.className = 'col-xs-1 col-sm-6 col-md-4 video';
          videoElementsById[video.id] = colDiv;

          const link = document.createElement('a');
          link.setAttribute('target', '_blank');
          link.href = `https://www.youtube.com/watch?v=${video.id.videoId}`;

          const videoElement = document.createElement('div');
          videoElement.className = 'card ma-1';
          videoElement.appendChild(link);

          const mediaBody = document.createElement('div');
          mediaBody.className = 'card-body';
          videoElement.appendChild(mediaBody);

          const h5 = document.createElement('h5');
          h5.className = 'card-title';
          h5.textContent = video.snippet.title;

          const dateTime = document.createElement('P');
          dateTime.className = 'card-text';
          dateTime.textContent = video.snippet.publishedAt;

          const channelTitle = document.createElement('P');
          channelTitle.className = 'card-text';
          channelTitle.textContent = video.snippet.channelTitle; 

  const favButton = document.createElement('button');
  favButton.id = video.id.videoId;
  const videoIdentifier = favButton.id
  favButton.className = 'btn btn-outline-primary';
  favButton.textContent = 'Add to Favorites';

  const removeBut = document.createElement('button');
  removeBut.id = video.id.videoId;
  const videoIdentifierR = removeBut.id
  removeBut.className = 'btn btn-outline-primary';
  removeBut.textContent = 'Remove from Favorites';
  
  removeBut.style.display = 'none';

  removeBut.addEventListener("click", function(){
                console.log(video);
                favVideos.splice( favVideos.indexOf(video), 1 );
                console.log(favVideos);
                localStorage.setItem('favs', JSON.stringify(favVideos));
                removeBut.style.display = 'none';
                favButton.style.display = 'unset';
              });

   favButton.addEventListener("click", function(){
     favVideos.push(video);
     console.log(favVideos);
     localStorage.setItem('favs', JSON.stringify(favVideos));
     let favs = JSON.parse(localStorage.getItem('favs'));
     document.getElementById("test").innerHTML = favs;
     removeBut.style.display = 'unset';
     favButton.style.display = 'none';
     // favButton.textContent = 'Remove from Favorites';
     });

     favVideos.forEach((favorite)=> {
      if(favorite.id.videoId === videoIdentifierR || favorite.id.videoId === videoIdentifier){
        removeBut.style.display = 'unset';
        favButton.style.display = 'none';
          // removeBut.addEventListener("click", function(){
          // console.log(video);
          // favVideos.splice( favVideos.indexOf(favorite), 1 );
          // console.log(favVideos);
          // localStorage.setItem('favs', JSON.stringify(favVideos));
          // removeBut.style.display = 'none';
          // favButton.style.display = 'unset';
          // });
      }
      
      });
   

  
 
          link.appendChild(h5);
          mediaBody.appendChild(favButton);
          mediaBody.appendChild(removeBut);
          mediaBody.appendChild(channelTitle);
          mediaBody.appendChild(dateTime);
          colDiv.appendChild(videoElement);
          videosElement.appendChild(colDiv);

//------------
var vid = document.createElement('div');
vidId = 'vid' + video.id.videoId;
vid.id = vidId;
mediaBody.appendChild(vid);
var player = new YT.Player(vidId, {
  height: '200 %',
  width: '200 %',
  videoId: video.id.videoId,
  events: {
    'onReady': onPlayerReady
  }
});

function onPlayerReady(e) {
  var myId = e.target.a.id;
  var duration = e.target.getDuration();
  if(duration === 0) {
    console.log('Video ' + myId + ' cannot be played, so it was deleted.');
    section.removeChild(e.target.a);
  } else {
    var myId = e.target.a.id;
    console.log('Video ' + myId + ' ready to play.');
  }
}

//------------------

          const videoDetailsURL = fetch(`https://www.googleapis.com/youtube/v3/videos?part=statistics&id=${video.id.videoId}&key=` + myKey)
          .then(response => response.json())
          .then(showvideoDetails);   

          function showvideoDetails(videoDetails) {
            localStorage.videoDetails = JSON.stringify(videoDetails);
            console.log(videoDetails);
            console.log(videoDetails.items[0].statistics);

            const videoMetadata = document.createElement('P');
            videoMetadata.className = 'card-text';
            videoMetadata.textContent = 'VIEW COUNT:' + videoDetails.items[0].statistics.viewCount + ' ' + 'LIKES:' + videoDetails.items[0].statistics.likeCount + ' ' + 'DISLIKES:' + videoDetails.items[0].statistics.dislikeCount + ' ' + 'FAVORITES:' + videoDetails.items[0].statistics.favoriteCount + ' ' + 'COMMENTS:' + videoDetails.items[0].statistics.commentCount;

            mediaBody.appendChild(videoMetadata); 
          }
        });
      }
    </script>


  </body>
  </html>
